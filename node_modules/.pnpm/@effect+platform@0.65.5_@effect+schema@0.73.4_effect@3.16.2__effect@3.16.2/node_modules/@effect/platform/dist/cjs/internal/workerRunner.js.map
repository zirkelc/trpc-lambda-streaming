{"version":3,"file":"workerRunner.js","names":["Schema","_interopRequireWildcard","require","Serializable","Cause","Chunk","Context","Effect","Either","Fiber","_Function","Layer","Schedule","Stream","Transferable","_WorkerError","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","PlatformRunnerTypeId","exports","Symbol","for","PlatformRunner","GenericTag","run","process","options","gen","platform","backing","start","fiberMap","Map","portId","id","kind","data","span","fiber","void","interrupt","withFiberRuntime","decode","succeed","pipe","flatMap","input","collector","unsafeMakeCollector","stream","effect","isEffect","out","encodeOutput","provideService","Collector","payload","send","unsafeRead","runForEachChunk","chunk","undefined","toReadonlyArray","unsafeClear","forEach","andThen","withParentSpan","_tag","traceId","spanId","sampled","context","empty","uninterruptibleMask","restore","catchIf","isWorkerError","error","WorkerError","encodeCause","fail","catchAllCause","cause","match","failureOrCause","onLeft","encodeError","onRight","ensuring","sync","delete","make","tapErrorCause","logDebug","retry","spaced","annotateLogs","package","module","interruptAsFork","interruptible","forkScoped","asVoid","layer","scopedDiscard","makeSerialized","schema","handlers","_","scope","parseRequest","decodeUnknown","request","result","isLayer","buildWithScope","merge","provide","provideContext","message","mapError","reason","serializeFailure","serializeSuccess","layerSerialized"],"sources":["../../../src/internal/workerRunner.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}